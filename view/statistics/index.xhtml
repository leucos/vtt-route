<?r def high_ok_bar(pct)
  tag = "<div class=\"bar"

  tag << " bar-success" if pct > 80
  tag << " bar-warning" if pct < 50 and pct > 30
  tag << " bar-danger" if pct <= 30
  tag <<  "\" style=\"width: #{pct}%;\"></div>"
  tag
end
?>

<h2 id="subtitle">#{@subtitle}</h2>

<div class="row-fluid">
  <span class="badge">#{@equipes}</span> Equipes : <span class="badge badge-success">#{@stats[:teams_stats][:solo][:count]}</span> solos, <span class="badge badge-info">#{@stats[:teams_stats][:duo][:count]}</span> duos, <span class="badge badge-warning">#{@stats[:teams_stats][:tandem][:count]}</span> tandems
  <div class="progress active">
    <div class="bar bar-success" style="width: #{@stats[:teams_stats][:solo][:percent]}%;"></div>
    <div class="bar" style="width: #{@stats[:teams_stats][:duo][:percent]}%;"></div>
    <div class="bar bar-warning" style="width: #{100-@stats[:teams_stats][:solo][:percent]-@stats[:teams_stats][:duo][:percent]}%;"></div>
  </div>
</div>


<div class="row-fluid">
  Répartition des équipes :
  <table class="table table-stripped table-bordered table-condensed">
    <?r @stats[:categories].each_pair do |cat, cnt| ?>
    <tr>
      <td>#{cat}</td>
      <td><span class="badge">#{cnt}</span></td>
    </tr>
    <?r end ?>
  </table>
</div>

<div class="row-fluid">
  Inscrits avec profil : <span class="badge">#{@stats[:people_with_profile][:count]}</span> 
  <div class="progress active">
    #{high_ok_bar(@stats[:people_with_profile][:percent])}
  </div>
</div>


<div class="row-fluid">
  Nombre d'utilisateurs dans une équipe : <span class="badge">#{@stats[:people_in_teams][:count]}</span> 
  <div class="progress active">
    #{high_ok_bar(@stats[:people_in_teams][:percent])}
  </div>
</div>


<div class="row-fluid">
  Utilisateurs ayant réglé : <span class="badge">#{@stats[:people_paid][:count]}</span> 
  <div class="progress active">
    #{high_ok_bar(@stats[:people_paid][:percent])}
  </div>
</div>


<div class="row-fluid">
  Inscription journalières :
  <div id="container" style="width:900px; height:384px; margin: 8px auto;">
  </div>
</div>


<script type ='text/javascript'>

$(function() {

  var
    container = document.getElementById('container'),
    d1 = #{@stats[:subscription_flotr].to_json}, // data series
    graph;

  //console.log(d1);
  // Draw Graph
  graph = Flotr.draw(container,
    [ d1 ], 
    {
      bars : {
        show : true,
        horizontal : false,
        shadowSize : 0
      },
      mouse : {
        track : true,
        relative : true
      },
      yaxis : {
        min : 0,
        autoscaleMargin : 1
      }
    }
  );
});

</script>